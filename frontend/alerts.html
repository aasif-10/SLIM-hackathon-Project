<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alerts | SLIM AI</title>
  <link rel="stylesheet" href="css/design-system.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <style>
    /* Page specific minimal overrides */
    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--text-main);
    }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .alert-card {
      border-left: 4px solid transparent;
      /* Status indicator strip */
    }

    .alert-card.high {
      border-left-color: var(--danger);
    }

    .alert-card.medium {
      border-left-color: var(--warning);
    }

    .alert-card.low {
      border-left-color: var(--primary);
    }

    .alert-card.none {
      border-left-color: var(--success);
    }

    .alert-kv {
      display: flex;
      gap: 4px;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    .alert-kv span:first-child {
      font-weight: 500;
      color: var(--text-main);
    }
  </style>
</head>

<body>
  <div id="app-nav" style="display: contents;"></div>

  <main class="main-content">
    <!-- Top Bar -->
    <header class="top-bar">
      <div class="page-title">Event Scanner</div>
      <div class="flex items-center gap-2">
        <div id="last-update" class="text-muted" style="font-size: 0.85rem;">Last updated: Just now</div>
      </div>
    </header>

    <div class="scroll-area">
      <div class="container">

        <!-- Summary Card -->
        <div class="card mb-4">
          <div class="flex justify-between items-center" style="padding:0 20px;">
            <div class="text-center">
              <div class="stat-value" id="high-count" style="color: var(--danger);">--</div>
              <div class="stat-label">Critical</div>
            </div>
            <div class="text-center">
              <div class="stat-value" id="medium-count" style="color: var(--warning);">--</div>
              <div class="stat-label">Warning</div>
            </div>
            <div class="text-center">
              <div class="stat-value" id="low-count" style="color: var(--primary);">--</div>
              <div class="stat-label">Info</div>
            </div>
            <div class="text-center">
              <div class="stat-value" id="clear-count" style="color: var(--success);">--</div>
              <div class="stat-label">Clear</div>
            </div>
          </div>
        </div>

        <!-- Alerts Grid -->
        <div class="grid-2" id="alerts-container">
          <!-- JS Injects here -->
        </div>
      </div>
    </div>
  </main>

  <script src="js/components.js"></script>
  <script>initPage('alerts');</script>

  <script>
    // Mock Data
    const mockAlerts = [
      {
        id: 1, title: 'Low Dissolved Oxygen', sensor: 'S-04 South Inlet', severity: 'high',
        description: 'DO level dropped to 3.2 mg/L, below critical threshold.',
        time: '2m ago', metrics: { do: '3.2 mg/L', temp: '29.1C' }
      },
      {
        id: 2, title: 'Turbidity Spike', sensor: 'S-04 South Inlet', severity: 'high',
        description: 'Reading of 485 NTU detected. Potential polluted inflow.',
        time: '8m ago', metrics: { turbidity: '485 NTU', change: '+304%' }
      },
      {
        id: 3, title: 'pH Level Drift', sensor: 'S-03 Central Deep', severity: 'medium',
        description: 'pH decreased from 7.4 to 6.8 over past 3 hours.',
        time: '15m ago', metrics: { ph: '6.8', rate: '-0.2/hr' }
      },
      {
        id: 4, title: 'Temp Anomaly', sensor: 'S-02 East Bay', severity: 'medium',
        description: 'Water temp +3.2C above daily average.',
        time: '23m ago', metrics: { temp: '24.5C', avg: '21.3C' }
      },
      {
        id: 6, title: 'Rainfall Impact', sensor: 'Network-wide', severity: 'low',
        description: 'Heavy rainfall (32mm) detected. Monitoring runoff.',
        time: '1h ago', metrics: { rainfall: '32mm', rain_duration: '6 hrs' }
      },
      {
        id: 7, title: 'Calibration Due', sensor: 'S-05 West Shore', severity: 'low',
        description: 'pH sensor calibration due in 48 hours.',
        time: '2h ago', metrics: { lastCal: '28d ago', status: 'Due Soon' }
      },
      {
        id: 8, title: 'Normal Ops', sensor: 'S-01 North Shore', severity: 'none',
        description: 'All parameters normal.', time: '3h ago', metrics: { status: 'Optimal' }
      }
    ];

    function getSeverityBadge(severity) {
      const map = { high: 'badge-danger', medium: 'badge-warning', low: 'badge-neutral', none: 'badge-success' };
      return `<span class="badge ${map[severity]}">${severity.toUpperCase()}</span>`;
    }

    function renderAlerts() {
      const container = document.getElementById('alerts-container');
      const sorted = [...mockAlerts].sort((a, b) => {
        const order = { high: 0, medium: 1, low: 2, none: 3 };
        return order[a.severity] - order[b.severity];
      });

      container.innerHTML = sorted.map(alert => {
        const metrics = Object.entries(alert.metrics).map(([k, v]) =>
          `<div class="alert-kv"><span>${k}:</span> <span>${v}</span></div>`
        ).join('');

        return `
              <div class="card alert-card ${alert.severity}" style="margin-bottom:0;">
                  <div class="flex justify-between items-center mb-2">
                       <div style="font-weight:600; color:var(--text-main);">${alert.title}</div>
                       ${getSeverityBadge(alert.severity)}
                  </div>
                  <div class="text-muted" style="font-size:0.8rem; margin-bottom:8px;">
                      ${alert.sensor} â€¢ ${alert.time}
                  </div>
                  <p style="font-size:0.9rem; margin-bottom:12px;">${alert.description}</p>
                  <div style="background:var(--slate-50); padding:8px; border-radius:var(--radius-sm);">
                      <div class="flex flex-wrap gap-4">
                          ${metrics}
                      </div>
                  </div>
              </div>
            `;
      }).join('');

      updateCounts();
    }

    function updateCounts() {
      const counts = { high: 0, medium: 0, low: 0, none: 0 };
      mockAlerts.forEach(a => counts[a.severity]++);
      document.getElementById('high-count').innerText = counts.high;
      document.getElementById('medium-count').innerText = counts.medium;
      document.getElementById('low-count').innerText = counts.low;
      document.getElementById('clear-count').innerText = counts.none;
    }

    renderAlerts();
  </script>
</body>

</html>