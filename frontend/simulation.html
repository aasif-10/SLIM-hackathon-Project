<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulation | SLIM AI</title>
  <link rel="stylesheet" href="css/design-system.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
  <script src="js/components.js"></script>
</head>

<body>
  <div id="app-nav" style="display: contents;"></div>

  <main class="main-content">
    <header class="top-bar">
      <div class="page-title">Digital Twin Simulation</div>
      <div class="flex items-center gap-2">
        <span class="badge badge-neutral">Env: Production Clone</span>
      </div>
    </header>

    <div class="scroll-area">
      <div class="container">

        <div class="grid-2">
          <!-- Control Panel -->
          <div>
            <div class="card">
              <div class="card-header">
                <div class="card-title">Scenario Parameters</div>
              </div>

              <form id="sim-form" style="display: flex; flex-direction: column; gap: 20px;">
                <div class="form-group">
                  <label class="label mb-2 block">Temperature Rise (°C)</label>
                  <input type="number" id="temperature_rise_c" class="form-input" step="0.1" min="0" max="10"
                    value="1.5" required>
                  <div class="text-muted mt-1" style="font-size:0.85rem;">Projected increase above baseline</div>
                </div>

                <div class="form-group">
                  <label class="label mb-2 block">Pollution Intensity (0-1)</label>
                  <input type="number" id="pollution_event_strength" class="form-input" step="0.05" min="0" max="1"
                    value="0.35" required>
                  <div class="text-muted mt-1" style="font-size:0.85rem;">Severity of chemical influx</div>
                </div>

                <div class="form-group">
                  <label class="label mb-2 block">Rainfall (mm/24h)</label>
                  <input type="number" id="rainfall_mm" class="form-input" step="1" min="0" max="200" value="20"
                    required>
                  <div class="text-muted mt-1" style="font-size:0.85rem;">Stormwater runoff volume</div>
                </div>

                <div class="flex justify-end pt-4 border-t border-slate-100">
                  <button type="submit" id="sim-btn" class="btn btn-primary">Run Simulation</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Results Panel -->
          <div>
            <div class="card" style="min-height: 480px;">
              <div class="card-header">
                <div class="card-title">Projected Impact</div>
                <div id="sim-status" class="badge badge-neutral">Waiting for input</div>
              </div>

              <div id="sim-results" class="flex flex-col gap-4">
                <div class="flex flex-col items-center justify-center text-muted h-64">
                  <div style="font-size:3rem; opacity:0.2; margin-bottom:1rem;">⚡</div>
                  <p>Configure parameters and run to see impact analysis.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </main>

  <script src="js/components.js"></script>
  <script>initPage('simulation');</script>

  <script>
    // V3 Logic
    const simResults = document.getElementById('sim-results');
    const simStatus = document.getElementById('sim-status');
    const simBtn = document.getElementById('sim-btn');

    function renderResultItem(title, data) {
      const sentiment = data.confidence.toLowerCase().includes('high') ? 'success' :
        data.confidence.toLowerCase().includes('low') ? 'danger' : 'warning';

      return `
        <div style="padding: 16px; border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--slate-50);">
            <div class="flex justify-between items-center mb-2">
                <span class="font-semibold text-slate-900">${title}</span>
                <span class="badge badge-${sentiment}">${data.confidence} Confidence</span>
            </div>
            <p class="text-slate-700 text-sm mb-2">${data.description}</p>
            <div class="flex items-start gap-2 text-xs text-muted">
                <span>⚠️</span>
                <span>${data.impact}</span>
            </div>
        </div>
        `;
    }

    async function runSim(e) {
      e.preventDefault();
      simBtn.disabled = true;
      simBtn.innerText = "Processing...";
      simStatus.innerText = "Running Model...";
      simStatus.className = "badge badge-primary";

      // Mock delay
      await new Promise(r => setTimeout(r, 1000));

      // Mock Response Data
      const mockData = {
        do: { description: 'DO levels expected to drop by 18% in lower strata.', impact: 'Risk of hypoxia for benthic organisms.', confidence: 'High' },
        pollution: { description: 'Contaminant plume will disperse within 6 hours.', impact: 'Temporary spike in turbidity at outlet.', confidence: 'Medium' },
        eco: { description: 'Algal bloom probability increased by 22%.', impact: 'Monitor chlorophyll-a levels closely.', confidence: 'Low' },
        fish: { description: 'Fish stress index remains within tolerance.', impact: 'No acute mortality predicted.', confidence: 'High' }
      };

      const html = `
            ${renderResultItem('DO Drop Scenario', mockData.do)}
            ${renderResultItem('Pollution Response', mockData.pollution)}
            ${renderResultItem('Ecological Risk', mockData.eco)}
            ${renderResultItem('Fauna Impact', mockData.fish)}
        `;

      simResults.innerHTML = html;
      simStatus.innerText = "Complete";
      simStatus.className = "badge badge-success";
      simBtn.disabled = false;
      simBtn.innerText = "Run Simulation";
    }

    document.getElementById('sim-form').addEventListener('submit', runSim);
  </script>
</body>

</html>